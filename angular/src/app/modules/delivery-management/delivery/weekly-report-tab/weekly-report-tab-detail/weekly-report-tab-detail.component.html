<mat-drawer-container class="example-container" style="min-height: 94vh;"
    *ngIf="permission.isGranted(WeeklyReport_ReportDetail_View)">
    <mat-drawer #drawer mode="side" opened style="position: fixed;top: 6%;padding-top: 10px;width: 15%;">
        <div>
            <div>
                <div class="p-1" style="background: #fff;position: sticky; top: 0;z-index: 2;">
                    <div class="input-group">
                        <div class="input-group-prepend">
                            <button type="button" class="btn bg-blue" (click)="search()">
                                <i class="fas fa-search"></i>
                            </button>
                        </div>
                        <input (keyup)="search()" type="text" class="form-control" name="keyword" placeholder="Search"
                            [(ngModel)]="searchText" />
                    </div>
                </div>

                <div style="margin-bottom: 20px;">
                    <p style="margin-left: 8px; font-size: 20px; margin-top: 20px; font-weight: 600;" *ngIf="pmReportProjectList.length < 1">No data !</p>
                    <mat-list *ngFor="let item of pmReportProjectList">
                        <div class="row sidebar-item" style="flex: 1;"
                            [ngClass]="item.setBackground == true ? 'projectActive' : ''">
                            <div class="col-10 project-menu-item"
                                [ngClass]="item.status === 'Sent' ? APP_CONST.bgProjectReportStyle[item.projectHealth] : 'grey'">
                                <mat-list-item style="cursor:pointer;" id="list" role="item.projectId"
                                    (click)="view(item);" [ngClass]="{'checked': item.seen, 'unchecked': !item.seen}">
                                    <div style="overflow: hidden; overflow-x: hidden; width: 100%;">
                                        <div class="project-list">
                                            <strong>{{item.projectName}} </strong>
                                        </div>
                                        <div class="project-list">
                                            <div class="email-address">{{item.pmEmailAddress}} </div>

                                            <div class="flex-container">
                                                <div class="project-code"
                                                    [matTooltip]="'Client Code - ' + item.clientCode">
                                                    {{item.clientCode}}</div>

                                                <div class="checkbox-text" matTooltip="Latest Review Date"
                                                    style="float: right;">
                                                    <div *ngIf="item.seen">
                                                        <div [innerHTML]="iconCheckedDate" class="inline-block"></div>
                                                        {{item.lastReviewDate ? (item.lastReviewDate | date:'dd/MM/yyyy
                                                        ') : 'Missing Review Date'}}
                                                    </div>
                                                    <div *ngIf="!item.seen && item.lastReviewDate">
                                                        <div [innerHTML]="iconCheckedDate" class="inline-block"></div>
                                                        {{item.lastReviewDate ? (item.lastReviewDate | date:'dd/MM/yyyy
                                                        ') + '' : 'Missing Review Date'}}
                                                    </div>
                                                    <div *ngIf="!item.seen && !item.lastReviewDate">
                                                        <div [innerHTML]="iconCheckedDate" class="inline-block"></div>
                                                        Yet Reviewed
                                                    </div>
                                                </div>
                                            </div>


                                        </div>
                                    </div>
                                </mat-list-item>
                            </div>
                            <div class="col-2 text-center">
                                <section class="example-section">
                                    <label class="star-checkbox">
                                        <input
                                            *ngIf="permission.isGranted(WeeklyReport_ReportDetail_PrioritizeReview_Check)"
                                            (change)="markReview(item)" [checked]="item.necessaryReview == true"
                                            [disabled]="item.isActive == false " type="checkbox">

                                        <span matTooltip="Prioritize Review" class="star" matTooltip="{{!item.isActive ? 'Cannot update Prioritize Review for closed Weekly Report'
                                            : item.necessaryReview ? 'Click to de-prioritize review '
                                            : !item.necessaryReview ? 'Click to prioritize review' : ''}}">
                                        </span>

                                    </label>
                                </section>

                                <mat-checkbox
                                    *ngIf=" permission.isGranted(WeeklyReport_ReportDetail_LastReviewDate_Check) "
                                    class="mt-2" [checked]="item.seen" [disabled]="item.isActive == false" matTooltip="{{!item.isActive ? 'Cannot update review of closed Weekly Report'
                                                 : item.seen ? 'Click mark project as not reviewed'
                                                 : 'Click to mark project as reviewed'}}"
                                    (click)="showConfirmModal($event, item)">
                                </mat-checkbox>

                            </div>

                        </div>
                    </mat-list>
                </div>

            </div>
        </div>
    </mat-drawer>
    <mat-drawer #drawerRight mode="side" opened position="end" class="pt-3" [ngClass] = "{changeWidth:drawerLeft}"
        style="width: 35%;background-color: #fafafa;">
        <div class="position-relative; px-2">
            <div>
                <div class="card">
                    <mat-expansion-panel [expanded]="isShowTimesheet">
                        <mat-expansion-panel-header class="m-0" (click)="isShowTimesheet=!isShowTimesheet">
                            <strong style="font-size: 20px;">Timesheet</strong>
                        </mat-expansion-panel-header>
                        <div style=" min-width: 100%; height:200px;margin-bottom: 20px;" id="timesheet-chart"></div>
                    </mat-expansion-panel>
                </div>

                <div class="card">
                    <mat-expansion-panel [expanded]="isShowBillInfo">
                        <mat-expansion-panel-header class="m-0" (click)="isShowBillInfo=!isShowBillInfo">
                            <strong style="font-size: 20px;">Bill info</strong>
                        </mat-expansion-panel-header>
                        <div style=" min-width: 100%; height:200px;margin-bottom: 20px;padding-right: 20px;"
                            id="bill-chart"></div>
                    </mat-expansion-panel>
                </div>

                <div class="card" *ngIf="permission.isGranted(WeeklyReport_ReportDetail_PlannedResource_View)">
                    <mat-expansion-panel [expanded]="isShowFutureList">
                        <mat-expansion-panel-header class="m-0 d-flex align-items-center" (click)="isShowFutureList=!isShowFutureList">
                            <strong style="font-size: 20px;">Planned Resource</strong> &nbsp;
                            <strong style="font-size: 20px;" class="text-danger">({{futureReportList?.length}})</strong>
                            <button class="btn bg-blue ml-3 btn-sm mb-2"
                                *ngIf=" permission.isGranted(WeeklyReport_ReportDetail_PlannedResource_CreateNewPlan) && isActive && !!projectId"
                                [hidden]="processFuture || !isShowFutureList "
                                (click)="addPlanResource(); $event.stopPropagation()"
                                style="padding: 0 5px;margin-bottom: 0 !important;">
                                <i class="fa fa-plus  m-0"></i>
                            </button>
                            <!-- <i class="fa fa-plus fa-lg ml-2 mt-2 text-primary"
                                *ngIf=" permission.isGranted(WeeklyReport_ReportDetail_PlannedResource_CreateNewPlan) && isActive"
                                [hidden]="processFuture || !isShowFutureList "
                                (click)="addPlanResource(); $event.stopPropagation()"></i> -->

                        </mat-expansion-panel-header>
                        <div class="px-4 pb-4 fixTableHead" style="max-height:46vh">
                            <table style="border-collapse: collapse;" class="table table-hover text-nowrap">
                                <thead class="bg-light">
                                    <tr>
                                        <th>Employee</th>
                                        <th>Role</th>
                                        <th class="col-time">Start date</th>
                                        <th>Join/Out</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr *ngFor="let report of futureReportList |paginate:{
                                                            id: 'futurePaging',
                                                        itemsPerPage: itemPerPage,
                                                        currentPage: futureCurrentPage
                                                        } ; let i=index">
                                        <td>
                                            <div *ngIf="!report.createMode"
                                                class="d-flex justify-content-between align-items-center">
                                                <app-user-info [isWeeklyReport]="true"
                                                    style="width: -webkit-fill-available;"
                                                    [userData]="{fullName:report.fullName,avatarFullPath:report.avatarFullPath,userType:report.userType,
                                                                    positionName:report.positionName,userLevel:report.userLevel,branchColor:report.branchColor,
                                                                    positionColor:report.positionColor,branchDisplayName:report.branchDisplayName}">
                                                </app-user-info>

                                                <i *ngIf="isShowMenuPlannedResource" style="color: #585858;"
                                                    class="fas fa-ellipsis-v fa-lg" [matMenuTriggerFor]="menu2"></i>

                                                <mat-menu #menu2="matMenu">
                                                    <button
                                                        *ngIf="report.allocatePercentage <= 0 && permission.isGranted(WeeklyReport_ReportDetail_PlannedResource_ConfirmOut)"
                                                        [disabled]="planResourceProcess" class="mat-menu-item  w-100"
                                                        (click)="confirm(report)"> <i
                                                            class="fas fa-check mr-1"></i>Confirm
                                                        Out</button>

                                                    <button
                                                        *ngIf="report.allocatePercentage > 0 && (permission.isGranted(WeeklyReport_ReportDetail_PlannedResource_ConfirmPickEmployeeFromPoolToProject)
                                                                        || permission.isGranted(WeeklyReport_ReportDetail_PlannedResource_ConfirmMoveEmployeeWorkingOnAProjectToOther) )"
                                                        [disabled]="planResourceProcess" class="mat-menu-item  w-100"
                                                        (click)="confirm(report)"> <i
                                                            class="fas fa-check mr-1"></i>Confirm
                                                        Join</button>

                                                    <button
                                                        *ngIf="permission.isGranted(WeeklyReport_ReportDetail_PlannedResource_CancelPlan)"
                                                        [disabled]="planResourceProcess" class="mat-menu-item  w-100"
                                                        (click)="cancelResourcePlan(report)"> <i
                                                            class="fas fa-times mr-1"></i>Cancel
                                                        Plan</button>
                                                    <button
                                                        *ngIf="permission.isGranted(WeeklyReport_ReportDetail_PlannedResource_Edit)"
                                                        [disabled]="planResourceProcess" class="mat-menu-item  w-100"
                                                        (click)="editResourcePlan(report)"> <i
                                                            class="fas fa-edit mr-1"></i>Edit</button>
                                                </mat-menu>
                                            </div>
                                            <div *ngIf="report.createMode" class="form-group row required">
                                                <mat-form-field class="w-100" appearance="outline">
                                                    <mat-select [(ngModel)]="report.userId" name="reportUser"
                                                        placeholder="select user" required #reportUser="ngModel">
                                                        <mat-form-field class="w-100 px-3 "
                                                            style="position: sticky; top: 0; z-index: 2; background-color: white;">
                                                            <input matInput [(ngModel)]="searchUser" name="searchUser"
                                                                (keydown)="$event.stopPropagation()" #search
                                                                placeholder="search">{{search.focus()}}
                                                        </mat-form-field>
                                                        <mat-option
                                                            *ngFor="let user of userList |listFilter: 'fullName' :searchUser : 'emailAddress': 'surname' : 'name'"
                                                            [value]="user.id">
                                                            {{user.fullName}} -
                                                            ({{user.emailAddress}})
                                                        </mat-option>
                                                    </mat-select>
                                                </mat-form-field>
                                                <mat-error class="mt-1"
                                                    *ngIf="reportUser.hasError('required') && reportUser.touched"
                                                    style="font-size: 13px;">
                                                    This field is required
                                                </mat-error>
                                            </div>
                                        </td>

                                        <td class="text-center" style="width: 80px;">
                                            <div class="" *ngIf="!report.createMode">
                                                <div [ngClass]="APP_CONST.projectUserRole[report.projectRole]">
                                                    {{report.projectRoleName}}
                                                </div>
                                            </div>
                                            <div *ngIf="report.createMode">
                                                <mat-form-field style="width: 150px;" class="mx-auto"
                                                    appearance="outline">
                                                    <mat-select [(ngModel)]="report.projectRole" name="projectrole"
                                                        placeholder="select a role" required #projectPM="ngModel">
                                                        <mat-option *ngFor="let role of projectRoleList"
                                                            [value]="APP_ENUM.ProjectUserRole[role]">
                                                            {{role}}</mat-option>
                                                    </mat-select>
                                                </mat-form-field>
                                                <mat-error class="mt-1"
                                                    *ngIf="projectPM.hasError('required') && projectPM.touched"
                                                    style="font-size: 13px;">
                                                    This field is required
                                                </mat-error>
                                            </div>
                                        </td>
                                        <td class="text-center">
                                            <div class="" *ngIf="!report.createMode">
                                                {{report.startTime | date:"dd/MM/yyyy"}}
                                            </div>
                                            <mat-form-field style="width: 150px;" appearance="outline"
                                                *ngIf="report.createMode">
                                                <input [min]="minDate" matInput [matDatepicker]="picker"
                                                    placeholder="chose a date" [(ngModel)]="report.startTime"
                                                    name="usercreateDate">
                                                <mat-datepicker-toggle matSuffix [for]="picker">
                                                </mat-datepicker-toggle>
                                                <mat-datepicker #picker></mat-datepicker>
                                            </mat-form-field>
                                        </td>
                                        <td>
                                            <div ngClass=""
                                                [ngClass]="report.allocatePercentage >0 ?'text-success' : 'text-danger'"
                                                class="text-center" *ngIf="!report.createMode">
                                                <strong>
                                                    {{report.allocatePercentage>0?'Join':'Out'}}</strong>
                                            </div>
                                            <div *ngIf="report.createMode">

                                                <mat-radio-group [(ngModel)]="report.allocatePercentage"
                                                    aria-label="Select an option" name="allocatePercentage2">
                                                    <mat-radio-button [value]="100">Join
                                                    </mat-radio-button>
                                                    <br />
                                                    <mat-radio-button [value]="0">Out
                                                    </mat-radio-button>
                                                </mat-radio-group>
                                            </div>
                                        </td>
                                    </tr>
                                </tbody>
                            </table>

                        </div>
                        <pagination-controls autoHide="true" id="futurePaging"
                            (pageChange)="futureCurrentPage = $event"></pagination-controls>
                    </mat-expansion-panel>

                </div>

                <div class="card" *ngIf="permission.isGranted(WeeklyReport_ReportDetail_ChangedResource)">
                    <mat-expansion-panel [expanded]="isShowWeeklyList">
                        <mat-expansion-panel-header class="m-0" (click)="isShowWeeklyList=!isShowWeeklyList">

                            <strong style="font-size: 20px;">Changed Resource</strong> &nbsp;
                            <strong style="font-size: 20px;" class="text-danger">({{weeklyReportList?.length}})</strong>
                        </mat-expansion-panel-header>



                        <div class="  px-4 pb-4 fixTableHead" style="max-height:46vh">
                            <table style="border-collapse: collapse;" class="table table-hover text-nowrap">
                                <thead class="bg-light">
                                    <tr>
                                        <th>Employee</th>
                                        <th style="width: 80px;">Role</th>
                                        <th class="col-time">Start date</th>
                                        <th>Join/Out</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr *ngFor="let report of weeklyReportList  |paginate:{
                                                id: 'projectUser',
                                            itemsPerPage: itemPerPage,
                                            currentPage: weeklyCurrentPage
                                            } ; let i=index">
                                        <td>
                                            <div *ngIf="!report.createMode" class="d-flex justify-content-between">
                                                <app-user-info [isWeeklyReport]="true"
                                                    style="width: -webkit-fill-available;"
                                                    [userData]="{fullName:report.fullName,avatarFullPath:report.avatarFullPath,userType:report.userType,
                                                                    positionName:report.positionName,userLevel:report.userLevel,branchColor:report.branchColor,
                                                                    positionColor:report.positionColor,branchDisplayName:report.branchDisplayName}">
                                                </app-user-info>

                                            </div>
                                            <div *ngIf="report.createMode" class="form-group row required">
                                                <mat-form-field class="w-100" appearance="outline">
                                                    <mat-select [(ngModel)]="report.userId" name="projectEmployee"
                                                        placeholder="select user" required #projectEmployee="ngModel">
                                                        <mat-form-field class="w-100 px-3 "
                                                            style="position: sticky; top: 0; z-index: 2; background-color: white;">
                                                            <input matInput [(ngModel)]="searchUser"
                                                                name="searchUserName"
                                                                (keydown)="$event.stopPropagation()" #search
                                                                placeholder="search">{{search.focus()}}
                                                        </mat-form-field>
                                                        <mat-option
                                                            *ngFor="let user of userList |listFilter : 'fullName'  :searchUser : 'emailAddress' : 'surname' : 'name'"
                                                            [value]="user.id">
                                                            {{user.fullName}} -
                                                            ({{user.emailAddress}})
                                                        </mat-option>
                                                    </mat-select>
                                                </mat-form-field>
                                                <mat-error class="mt-1"
                                                    *ngIf="projectEmployee.hasError('required') && projectEmployee.touched"
                                                    style="font-size: 13px;">
                                                    This field is required
                                                </mat-error>
                                            </div>



                                        </td>

                                        <td class="text-center">
                                            <div class="" *ngIf="!report.createMode">
                                                <div [ngClass]="APP_CONST.projectUserRole[report.projectRole]">
                                                    {{report.projectRoleName}}
                                                </div>
                                            </div>
                                            <div *ngIf="report.createMode">
                                                <mat-form-field style="width: 150px;" class="mx-auto"
                                                    appearance="outline">
                                                    <mat-select [(ngModel)]="report.projectRole" name="projectrole"
                                                        placeholder="select a role" required #projectPM="ngModel">
                                                        <mat-option *ngFor="let role of projectRoleList"
                                                            [value]="APP_ENUM.ProjectUserRole[role]">
                                                            {{role}}</mat-option>
                                                    </mat-select>
                                                </mat-form-field>
                                                <mat-error class="mt-1"
                                                    *ngIf="projectPM.hasError('required') && projectPM.touched"
                                                    style="font-size: 13px;">
                                                    This field is required
                                                </mat-error>
                                            </div>
                                        </td>
                                        <td class="text-center">
                                            <div class="" *ngIf="!report.createMode">
                                                {{report.startTime | date:"dd/MM/yyyy"}}
                                            </div>
                                            <mat-form-field style="width: 150px;" appearance="outline"
                                                *ngIf="report.createMode">
                                                <input matInput [matDatepicker]="picker" placeholder="chose a date"
                                                    required [(ngModel)]="report.startTime" name="usercreateDate">
                                                <mat-datepicker-toggle matSuffix [for]="picker">
                                                </mat-datepicker-toggle>
                                                <mat-datepicker #picker></mat-datepicker>
                                            </mat-form-field>
                                        </td>
                                        <td>
                                            <div [ngClass]="report.allocatePercentage >0 ?'text-success' : 'text-danger'"
                                                *ngIf="!report.createMode" class="text-center ">
                                                <strong>
                                                    {{report.allocatePercentage >0 ?'Join' :
                                                    'Out'}}</strong>
                                            </div>
                                            <div *ngIf="report.createMode">

                                                <mat-radio-group [(ngModel)]="report.allocatePercentage"
                                                    aria-label="Select an option" name="allocatePercentage">
                                                    <mat-radio-button [value]="100">Join
                                                    </mat-radio-button>
                                                    <br />
                                                    <mat-radio-button [value]="0">Out
                                                    </mat-radio-button>
                                                </mat-radio-group>
                                            </div>
                                        </td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                        <pagination-controls autoHide="true" id="projectUser"
                            (pageChange)="weeklyCurrentPage = $event"></pagination-controls>
                    </mat-expansion-panel>

                </div>

                <div class="card" id="support-resource"
                    *ngIf="permission.isGranted(WeeklyReport_ReportDetail_CurrentResource_View)">
                    <mat-expansion-panel [expanded]="isShowSupportUser">
                        <mat-expansion-panel-header class="m-0 " (click)="isShowSupportUser=!isShowSupportUser">
                            <strong style="font-size: 20px;">Support User</strong> &nbsp;
                            <strong style="font-size: 20px;"
                                class="text-danger">({{projectCurrentSupportUser?.length}})</strong>
                        </mat-expansion-panel-header>
                        <div class="card-body">
                            <div class="fixTableHead" style="max-height: 46vh;">
                                <table class="table table-hover ">
                                    <thead>
                                        <tr>
                                            <th style="vertical-align: middle;">Employee</th>
                                            <th style="width: 80px;">Normal
                                                <div [matTooltip]="fixedNumber(totalNormalWorkingTime1) + 'h of project'
                                        + ' / ' + fixedNumber(totalNormalWorkingTimeOfWeekly1) + 'h all'
                                        + ' / ' + fixedNumber(totalNormalWorkingTimeStandard1) + 'h standard'">
                                                    <strong>({{fixedNumber(totalNormalWorkingTime1)}}h</strong> /
                                                    <strong>{{fixedNumber(totalNormalWorkingTimeOfWeekly1)}}h</strong>/
                                                    <strong>{{fixedNumber(totalNormalWorkingTimeStandard1)}}h)</strong>
                                                </div>
                                            </th>
                                            <th style="width: 80px;">OT
                                                <div
                                                    [matTooltip]="fixedNumber(overTimeNoCharge) + 'h total OT NoCharge' + ' / ' + fixedNumber(totalOverTime) + 'h total OT'">
                                                    (
                                                    <strong
                                                        [ngClass]="overTimeNoCharge1>0?'ot-noCharge':''">{{fixedNumber(overTimeNoCharge1)}}h
                                                    </strong> /
                                                    <strong
                                                        [ngClass]="totalOverTime1>0?'text-danger':''">{{fixedNumber(totalOverTime1)}}h
                                                    </strong>
                                                    )
                                                </div>
                                            </th>
                                            <!-- <th style="width: 50px;">Action</th> -->
                                            <th style="vertical-align: middle;">Timesheet</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <tr *ngFor="let user of projectCurrentSupportUser; let i =index">
                                            <td class="d-flex justify-content-between" style="border: none;">
                                                <div style="width: 80%;">
                                                    <app-user-info [isWeeklyReport]="true" [userData]="user">
                                                    </app-user-info>
                                                </div>
                                                <div style="display: flex; align-items: center;">
                                                    <span class="badge"
                                                        style="background-color: red; border-radius: 1rem; color: white;"
                                                        *ngIf="!user.isActive">Đã Nghỉ</span>
                                                </div>
                                                <div style="visibility: hidden; position: fixed"
                                                    [style.left]="contextMenuPosition.x"
                                                    [style.top]="contextMenuPosition.y" [matMenuTriggerFor]="menu">
                                                </div>
                                                <button mat-icon-button [matMenuTriggerFor]="menu"
                                                    style="display: none;">
                                                </button>
                                                <mat-menu #menu="matMenu">
                                                    <button
                                                        *ngIf="permission.isGranted(WeeklyReport_ReportDetail_CurrentResource_Release)"
                                                        [disabled]="projectUserProcess" class="mat-menu-item  w-100"
                                                        (click)="releaseUser(user)">
                                                        <i class="fas fa-sign-out-alt mr-1"></i>Release</button>
                                                </mat-menu>
                                            </td>
                                            <td class="text-center">
                                                <div [matTooltip]="user.normalWorkingTime + 'h of project'
                                        + ' / ' + user.normalWorkingTimeAll + 'h all'
                                        + ' / ' + user.normalWorkingTimeStandard + 'h standard'">
                                                    <strong>{{user?.normalWorkingTime}}</strong> /
                                                    <strong
                                                        [ngClass]="(user.normalWorkingTimeAll <= user.normalWorkingTimeStandard)?'':'time-over'">{{user?.normalWorkingTimeAll}}</strong>
                                                    /
                                                    <strong>{{user?.normalWorkingTimeStandard}}</strong>
                                                </div>
                                            </td>
                                            <td class="text-center">
                                                <div
                                                    [matTooltip]="user.overTimeNoCharge + 'h OT NoCharge' + ' / ' + user.overTime + 'h OT'">
                                                    <strong
                                                        [ngClass]="user.overTimeNoCharge>0?'ot-noCharge': ''">{{user.overTimeNoCharge}}</strong>
                                                    / <strong
                                                        [ngClass]="user.overTime>0?'text-danger': ''">{{user.overTime}}</strong>
                                                </div>
                                            </td>
                                            <td style="text-align: -webkit-center;">
                                                <div style="width: 200px; height: 60px;" [id]="'user' + user.userId">
                                                </div>
                                            </td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </mat-expansion-panel>
                </div>
            </div>
        </div>
    </mat-drawer>
    <div class="row pt-3 pr-3 ml-2" style="position: relative;" 
        *ngIf="permission.isGranted(WeeklyReport_ReportDetail_View)" #tref>
        <div id="right-content" [ngClass]="sidebarExpanded?'expand-content':''" style="width: 100%;">
            <section class="content ">
                <div class="row justify-content-start flex-nowrap">
                    <div class="position-relative mr-2" style="border-right: none; width: 100%;">
                        <div class="px-4 pb-2 pt-2 card position-relative"
                            style="display: flex; flex-direction: column; justify-content: space-between; ">
                            <div class="row p-1 align-items-center">
                                <div class="col-8 m-0 p-0 d-flex align-items-center">

                                    <span *ngIf="permission.isGranted(WeeklyReport_ReportDetail_GuideLine_View) && !!projectId">
                                        <strong class="hyperlink" (click)="guideLineCriteriaStatus()" style="font-size: 20px;">Criteria status</strong>
                                    </span>

                                      <span *ngIf="!permission.isGranted(WeeklyReport_ReportDetail_GuideLine_View) || !projectId">
                                        <strong style="font-size: 20px;">Criteria status </strong>
                                    </span>

                                      <div *ngIf="!!projectId">
                                        <button class="btn btn-editall-neutral ml-2" *ngIf="isShowEditAllBtn()"
                                        (click)="editAllRow()">
                                        <i class="fas fa-pencil-alt mr-1"></i> Edit All</button>
                                        <div *ngIf="isEditingAllRow()" class="pt-1 ml-4">
                                                <button class="mr-3 submit-btn" style="background: none; border: none"
                                                    (click)="saveAllUpdate()">
                                                    <i style="color: green" class="fas fa-check fa-2x"></i>
                                                </button>
                                                <i style="color: red" class="fas fa-times fa-2x"
                                                    (click)="cancelUpdateAll()"></i>
                                        </div>
                                      </div>
                                    <mat-checkbox [color]="'primary'" class="pl-3"
                                        (change)="showLastWeek(listCriteriaResult,$event.checked)"
                                        [checked]="isShowLastWeek()">Show last week</mat-checkbox>
                                </div>
                                <div class="col text-right">
                                    <span>Time send report: {{timeSentReport}}</span>
                                </div>
                            </div>

                            <div>
                                <div *ngIf="permission.isGranted(WeeklyReport_ReportDetail_ProjectHealthCriteria)" class="fixTableHead" style="max-height: none;">
                                    <div *ngFor="let item of listCriteriaResult let i =index">
                                        <div class="d-flex justify-content-between align-items-center">
                                            <lable
                                            *ngIf="permission.isGranted(WeeklyReport_ReportDetail_ProjectHealthCriteria_View_Guideline)" style="white-space: normal;" class="text-primary guide-line"
                                                (click)="showGuideLine(item)">
                                                <strong>{{item.criteriaName}}</strong> &nbsp;
                                                <i class="fas fa-question-circle "></i>
                                            </lable>
                                            <lable
                                            *ngIf="!permission.isGranted(WeeklyReport_ReportDetail_ProjectHealthCriteria_View_Guideline)"
                                               ><strong>{{item.criteriaName}}</strong>
                                            </lable>

                                            <div class="d-flex align-items-center">
                                                <ng-container
                                                    *ngIf="(permission.isGranted(WeeklyReport_ReportDetail_ProjectHealthCriteria_ChangeStatus) && isActive && !item.editMode)
                                                    ||(permission.isGranted(WeeklyReport_ReportDetail_ProjectHealthCriteria_ChangeStatus) && permission.isGranted(WeeklyReport_ReportDetail_ProjectHealthCriteria_Edit)  && isActive && item.editMode)">
                                                    <mat-form-field
                                                        [ngClass]="APP_CONST.projectHealthStyle[item.status]"
                                                        style="margin-left: 10px !important;width: 100px;" class="ml-3"
                                                        appearance="outline">
                                                        <mat-select name="flag" placeholder="Select Status"
                                                            [(ngModel)]="item.status"
                                                            (ngModelChange)="handleChangeStatus(item)">
                                                            <ng-container *ngFor="let flag of problemIssueList">
                                                                <mat-option style="border: 1px white solid;"
                                                                    [ngClass]="APP_CONST.projectHealthBGStyle[APP_ENUM.ProjectHealth[flag]]"
                                                                    [value]="APP_ENUM.ProjectHealth[flag]">
                                                                    <span style="font-weight: 100 !important;">
                                                                        {{flag}}
                                                                    </span>
                                                                </mat-option>
                                                            </ng-container>
                                                        </mat-select>
                                                    </mat-form-field>
                                                </ng-container>
                                                <span
                                                    *ngIf="!permission.isGranted(WeeklyReport_ReportDetail_ProjectHealthCriteria_ChangeStatus) || !isActive"
                                                    [ngClass]="APP_CONST.projectHealthBGStyle[item.status]">
                                                    {{problemIssueList[item.status - 1]}}</span>
                                                <button mat-button (click)="showCriteriaHistory(item,i)">
                                                    <i class="fas "
                                                        [ngClass]="item.isShowHistory==false?'fa-eye':'fa-eye-slash'"></i>
                                                </button>
                                                <div
                                                    *ngIf="permission.isGranted(WeeklyReport_ReportDetail_ProjectHealthCriteria_Edit) && !isEditingAllRow()">
                                                    <button *ngIf="!item.editMode && isActive" mat-button
                                                        (click)="handleEditCriteriaResult(i)">
                                                        <i class="fas fa-pencil-alt fa-lg "></i>
                                                    </button>
                                                    <div *ngIf="item.editMode && isActive"
                                                        class="d-flex align-items-center ">
                                                        <button class=" mr-3 submit-btn"
                                                            style="background: none; border: none;"
                                                            (click)="saveCriteriaResult(item,i)">
                                                            <i style="color: green;font-size: 24px;"
                                                                class="fas fa-check"></i>
                                                        </button>
                                                        <button class=" submit-btn"
                                                            style="background: none; border: none;"
                                                            (click)="cancelEditCriteriaResult(i)">
                                                            <i style="color: red; font-size: 24px;"
                                                                class="fas fa-times"></i>
                                                        </button>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="break-word" *ngIf="!item.editMode" [innerHTML]="item.note| safeHtml"></div>
                                        <div *ngIf="item.editMode && isActive">
                                            <editor
                                            id=""
                                            [(ngModel)]="item.note"
                                            [init]="{
                                              height:100,
                                              menubar: true,
                                              plugins: ['table', 'code', 'preview', 'media', 'image', 'template'],
                                              toolbars: ['image'],
                                              branding: false,
                                              forced_root_block: false,
                                              paste_retain_style_properties: true
                                            }"
                                          ></editor>
                                        </div>
                                        <div *ngIf="item.isShowHistory==true &&oldWeeklyReport" class="rounded my-4"
                                            style="border: 1px solid #C9C8C8 ; background-color: #F1F1E5;">
                                            <div class="d-flex align-items-baseline">
                                                <span>
                                                    <i class="m-2 fas fa-circle fa-lg"
                                                        [ngClass]="getOldCriteriaHealth(item)"></i>
                                                </span>
                                                <span class="m-2 overflow-auto d-flex">
                                                    <strong>{{oldWeeklyReport.pmReportName}}: </strong>
                                                    <span class="mb-0 p-0  ml-2" [innerHTML]="getOldNote(item) | safeHtml"></span>
                                                </span>
                                            </div>
                                        </div>
                                        <!-- <hr *ngIf="i<listCriteriaResult.length-1"> -->
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class=" card ">
                            <mat-expansion-panel [expanded]="isShowPmNote">
                                <mat-expansion-panel-header class="m-0" #pmNote (click)="isShowPmNote=!isShowPmNote">
                                    <mat-panel-title>
                                        <!-- <strong style="font-size: 20px;" class="hyperlink" (click)="$event.stopPropagation();guideLinePMNote()">PM Note</strong> -->
                                        <span (click)="$event.stopPropagation();">
                                            <span *ngIf="permission.isGranted(WeeklyReport_ReportDetail_GuideLine_View) && !!projectId">
                                                <strong class="hyperlink" (click)="$event.stopPropagation();guideLinePMNote()" style="font-size: 20px;">PM Note</strong>
                                              </span>

                                              <span *ngIf="!permission.isGranted(WeeklyReport_ReportDetail_GuideLine_View) || !projectId">
                                                <strong style="font-size: 20px;">PM Note</strong>
                                              </span>
                                              </span>
                                        <div class="d-inline ml-2 pt-1 text-right row"
                                            *ngIf="permission.isGranted(WeeklyReport_ReportDetail_UpdateNote) && !!projectId">
                                            <i [hidden]="!isActive || !isShowPmNote " *ngIf="!isEditingNote"
                                                class="fas fa-edit fa-lg" style="font-size: 17px;"
                                                (click)="isEditingNote = true ;$event.stopPropagation()"></i>
                                            <i style="color: green ;" class="fas fa-check fa-2x" *ngIf="isEditingNote"
                                                (click)="updateNote();$event.stopPropagation()"></i>
                                            <i *ngIf="isEditingNote" (click)="cancelUpdateNote();$event.stopPropagation()" style="color: red;"
                                                class=" ml-1 fas fa-times fa-2x mr-3"></i>
                                        </div>
                                    </mat-panel-title>
                                </mat-expansion-panel-header>
                                <div class="row p-1 px-4">
                                    <div class="col">
                                        <p *ngIf="!isEditingNote"
                                            style="word-wrap: break-word; white-space: pre-line;font-size: 18px;text-align: justify;"
                                            class="mt-2">
                                            {{generalNote}}
                                        </p>
                                        <mat-form-field class="ml-1" style="width:100%" appearance="outline"
                                            *ngIf="isEditingNote">
                                            <textarea #generalNoteFocus cdkTextareaAutosize
                                                #autosize="cdkTextareaAutosize" style="padding-bottom: 20px;" rows="2"
                                                id="message" matInput [(ngModel)]="generalNote" name="notePM"
                                                placeholder="General note">{{generalNoteFocus.focus()}}
                                            </textarea>
                                        </mat-form-field>
                                        <div *ngIf="(isShowLastWeek() == true || showPmNote==true ||isShowPMNotes()==true)&&oldWeeklyReport"
                                            class="rounded my-4"
                                            style="border: 1px solid #C9C8C8 ; background-color: #F1F1E5;">
                                            <div class="d-flex align-items-baseline">
                                                <span class="m-2 overflow-auto">
                                                    <strong>{{oldWeeklyReport.pmReportName}}: </strong>
                                                    <span  [innerHTML]="oldWeeklyReport.note| safeHtml "></span>
                                                </span>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </mat-expansion-panel>
                        </div>

                        <div class=" card " *ngIf="permission.isGranted(WeeklyReport_ReportDetail_Issue_View)">
                            <mat-expansion-panel [expanded]="isShowIssues">
                                <mat-expansion-panel-header class="m-0" #issues (click)="isShowIssues=!isShowIssues">
                                    <mat-panel-title>
                                        <span (click)="$event.stopPropagation();">
                                                <span *ngIf="permission.isGranted(WeeklyReport_ReportDetail_GuideLine_View) && !!projectId">
                                                    <strong class="hyperlink" (click)="guideLineIssue()" style="font-size: 20px;">Issues</strong>
                                                  </span>

                                                  <span *ngIf="!permission.isGranted(WeeklyReport_ReportDetail_GuideLine_View) || !projectId">
                                                    <strong style="font-size: 20px;">Issues</strong>
                                                  </span>
                                                 &nbsp;
                                            <strong style="font-size: 20px;"
                                                class="text-danger">({{problemList?.length}})</strong>
                                        </span>
                                    </mat-panel-title>
                                </mat-expansion-panel-header>
                                <div class="px-4 fixTableHead" style="max-height:46vh">
                                    <table style="border-collapse: collapse;" class="table table-hover text-nowrap">
                                        <thead class="bg-light">
                                            <tr>
                                                <th
                                                    *ngIf="permission.isGranted(WeeklyReport_ReportDetail_Issue_SetDone) && isActive">
                                                    #</th>
                                                <th>Issues</th>
                                                <th>Impact</th>
                                                <th>Solution</th>
                                                <th>Meeting Solution</th>
                                                <th class="col-time">Status</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            <tr *ngFor="let problem of problemList |paginate:{
                                                id: 'problemPaging',
                                            itemsPerPage: itemPerPage,
                                            currentPage: problemCurrentPage
                                            }; let i =index">
                                                <td *ngIf="permission.isGranted(WeeklyReport_ReportDetail_Issue_SetDone) && isActive"
                                                    style="width: 26px">
                                                    <i style="margin-top: 8px ; color: #585858;"
                                                        class="fas fa-ellipsis-v ml-1" [matMenuTriggerFor]="menu3"></i>
                                                    <mat-menu #menu3="matMenu">
                                                        <button (click)="setDone(problem)" class="mat-menu-item  w-100">
                                                            <i class="fas fa-check mr-2 fa-lg "></i>
                                                            <span *ngIf="isShowChangeDoneText(problem)">Set Done</span>
                                                            <span *ngIf="isShowChangeInProgressText(problem)">Set
                                                                InProgress</span>
                                                        </button>
                                                    </mat-menu>
                                                </td>
                                                <td style="white-space: normal;max-width: 250px;">
                                                    <div PrjResizeContent [collapseLine]="2"
                                                        class="mb-0 p-0  ml-2 max-line-content-2"
                                                        [innerHTML]="problem.description"></div>
                                                </td>
                                                <td style="white-space: normal;max-width: 200px;">
                                                    <div PrjResizeContent [collapseLine]="2"
                                                        class="mb-0 p-0  ml-2 max-line-content-2"
                                                        [innerHTML]="problem.impact"></div>
                                                </td>
                                                <td style="white-space: normal;max-width: 200px;">
                                                    <div PrjResizeContent [collapseLine]="2"
                                                        class="mb-0 p-0  ml-2 max-line-content-2"
                                                        [innerHTML]="problem.solution"></div>
                                                </td>
                                                <td style="white-space: normal;max-width: 200px;">
                                                    <div class="d-flex">
                                                        <div PrjResizeContent [collapseLine]="2"
                                                            class="mb-0 p-0  ml-2 max-line-content-2"
                                                            [innerHTML]="problem.meetingSolution"></div>
                                                        <div class="col-1 center-item">
                                                            <i class="fas fa-edit mr-1"
                                                                *ngIf="permission.isGranted(WeeklyReport_ReportDetail_Issue_AddMeetingNote) && isActive"
                                                                (click)="editMeetingNote(problem)"></i>
                                                        </div>
                                                    </div>
                                                </td>
                                                <td class="text-center">
                                                    <span
                                                        [ngClass]="APP_CONST.PMReportProjectIssueStatusStyle[problem.status]"
                                                        *ngIf="!problem.createMode">{{ problem.status }}</span>
                                                    <div>
                                                        <div style="font-size: 15px;" *ngIf="problem.totalWeekAgo>1">
                                                            <strong
                                                                class="text-danger">{{(problem.totalWeekAgo/7).toFixed()}}
                                                            </strong> weeks ago
                                                        </div>
                                                    </div>
                                                    <div *ngIf="problem.createMode">
                                                        <mat-form-field style="width: 150px;" class="mx-auto"
                                                            appearance="outline">
                                                            <mat-select [(ngModel)]="problem.status" name="issueStatus"
                                                                placeholder="select a status" required
                                                                #issueStatus="ngModel">
                                                                <mat-option *ngFor="let status of issueStatusList"
                                                                    [value]="APP_ENUM.PMReportProjectIssueStatus[status]">
                                                                    {{status}}</mat-option>
                                                            </mat-select>
                                                        </mat-form-field>
                                                        <mat-error class="mt-1"
                                                            *ngIf="issueStatus.hasError('required') && issueStatus.touched"
                                                            style="font-size: 13px;">
                                                            This field is required
                                                        </mat-error>
                                                    </div>
                                                </td>
                                            </tr>
                                        </tbody>
                                    </table>
                                </div>
                            </mat-expansion-panel>
                        </div>

                        <div class=" card " *ngIf="permission.isGranted(WeeklyReport_ReportDetail_PMRisk_View)">
                            <mat-expansion-panel [expanded]="isShowRisks">
                                <mat-expansion-panel-header class="m-0" #panelH (click)="isShowRisks=!isShowRisks ">
                                    <mat-panel-title>
                                        <span (click)="$event.stopPropagation();">
                                                <span *ngIf="permission.isGranted(WeeklyReport_ReportDetail_GuideLine_View) && !!projectId">
                                                    <strong class="hyperlink" (click)="guideLineRisk()" style="font-size: 20px;">Risk</strong>
                                                  </span>

                                                  <span *ngIf="!permission.isGranted(WeeklyReport_ReportDetail_GuideLine_View) || !projectId">
                                                    <strong style="font-size: 20px;">Risk </strong>
                                                  </span>
                                                 &nbsp;
                                            <strong style="font-size: 20px; "
                                                class="text-danger">({{projectRiskList?.length}})</strong>
                                        </span>

                                    </mat-panel-title>
                                </mat-expansion-panel-header>
                                <div class="px-4 fixTableHead" style="max-height:46vh">
                                    <table style="border-collapse: collapse;" class="table table-hover text-nowrap">
                                        <thead class="bg-light">
                                            <tr>
                                                <th
                                                    *ngIf="permission.isGranted(WeeklyReport_ReportDetail_PMRisk_SetDone) && isActive">
                                                    #</th>
                                                <th>Risks</th>
                                                <th>Impact</th>
                                                <th>Solution</th>
                                                <th style="width: 100px;">Priority</th>
                                                <th class="col-time">Status</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            <tr *ngFor="let problem of projectRiskList |paginate:{
                                                    id: 'problemPaging',
                                                itemsPerPage: itemPerPage,
                                                currentPage: problemCurrentPage
                                                }; let i =index">
                                                <td *ngIf="permission.isGranted(WeeklyReport_ReportDetail_PMRisk_SetDone) && isActive"
                                                    style="width: 26px">
                                                    <i style="margin-top: 8px ; color: #585858;"
                                                        class="fas fa-ellipsis-v ml-1" [matMenuTriggerFor]="menu3"></i>
                                                    <mat-menu #menu3="matMenu">
                                                        <button (click)="setDoneRisk(problem)"
                                                            *ngIf="isShowChangeDoneTextRisk(problem)"
                                                            class="mat-menu-item  w-100">
                                                            <i class="fas fa-check mr-2 fa-lg "></i>
                                                            <span>Set Done</span>
                                                        </button>
                                                        <button (click)="setInProgressRisk(problem)"
                                                            *ngIf="isShowChangeInProgressTextRisk(problem)"
                                                            class="mat-menu-item  w-100">
                                                            <i class="fas fa-check mr-2 fa-lg "></i>
                                                            <span>Set InProgress</span>
                                                        </button>
                                                    </mat-menu>
                                                </td>
                                                <td style="white-space: normal;max-width: 250px;">
                                                    <div PrjResizeContent [collapseLine]="2"
                                                        class="mb-0 p-0  ml-2 max-line-content-2"
                                                        [innerHTML]="problem.risk"></div>
                                                </td>
                                                <td style="white-space: normal;max-width: 200px;">
                                                    <div PrjResizeContent [collapseLine]="2"
                                                        class="mb-0 p-0  ml-2 max-line-content-2"
                                                        [innerHTML]="problem.impact"></div>
                                                </td>
                                                <td style="white-space: normal;max-width: 200px;">
                                                    <div PrjResizeContent [collapseLine]="2"
                                                        class="mb-0 p-0  ml-2 max-line-content-2"
                                                        [innerHTML]="problem.solution"></div>
                                                </td>
                                                <td style="white-space: normal" class="text-center">
                                                    <span
                                                        style="border-radius: 99px; padding: 0.25em 0.6em;font-size: 75%; font-weight: 700;"
                                                        [ngClass]="APP_CONST.priorityRisk[problem.priority] ">{{
                                                        priorityList[problem.priority] }}</span>
                                                </td>
                                                <td class="text-center">
                                                    <span
                                                        [ngClass]="APP_CONST.PMReportProjectIssueStatusStyle[riskStatusList[problem.status]] ">{{
                                                        riskStatusList[problem.status] }}</span>
                                                </td>
                                            </tr>
                                        </tbody>
                                    </table>
                                </div>
                            </mat-expansion-panel>
                        </div>

                        <div class="card" id="current-resource"
                            *ngIf="permission.isGranted(WeeklyReport_ReportDetail_CurrentResource_View)">
                            <mat-expansion-panel [expanded]="isShowCurrentResource">
                                <mat-expansion-panel-header class="m-0" #resource
                                    (click)="isShowCurrentResource=!isShowCurrentResource">
                                    <mat-panel-title class="align-items-baseline d-flex align-items-center">
                                        <strong style="font-size: 20px; ">Current Resource</strong>&nbsp;
                                        <strong style="font-size: 20px;"
                                            class="text-danger">({{projectCurrentResource?.length}})</strong>
                                        <span style="font-size: 20px; margin-left: 21px; font-weight: bold;">Charged
                                            accounts <strong
                                                class="text-danger">({{projectInfo.totalBill || 0}})</strong></span>
                                    </mat-panel-title>
                                </mat-expansion-panel-header>
                                <div class="card-body">
                                    <div class="fixTableHead" style="max-height: 72vh;">
                                        <table class="table table-hover ">
                                            <thead>
                                                <tr>
                                                    <th style="vertical-align: middle;" class="col-3">Employee</th>
                                                    <th style=" vertical-align: middle;" class="col-4">Note</th>
                                                    <th>Normal
                                                        <div
                                                            [matTooltip]="fixedNumber(totalNormalWorkingTime) + 'h of project'
                                                        + '/' + fixedNumber(totalNormalWorkingTimeOfWeekly) + 'h all'
                                                        + '/' + fixedNumber(totalNormalWorkingTimeStandard) + 'h standard' ">
                                                            <strong>({{fixedNumber(totalNormalWorkingTime)}}h</strong>/
                                                            <strong>{{fixedNumber(totalNormalWorkingTimeOfWeekly)}}h</strong>/
                                                            <strong>{{fixedNumber(totalNormalWorkingTimeStandard)}}h)</strong>
                                                        </div>
                                                    </th>
                                                    <th class="col-1">OT
                                                        <div
                                                            [matTooltip]="fixedNumber(overTimeNoCharge) + 'h total OT NoCharge' + ' / ' + fixedNumber(totalOverTime) + 'h total OT'">
                                                            (
                                                            <strong
                                                                [ngClass]="overTimeNoCharge>0?'ot-noCharge':''">{{fixedNumber(overTimeNoCharge)}}h
                                                            </strong> /
                                                            <strong
                                                                [ngClass]="totalOverTime>0?'text-danger':''">{{fixedNumber(totalOverTime)}}h
                                                            </strong>
                                                            )
                                                        </div>
                                                    </th>
                                                    <!-- <th style="width: 50px;">Action</th> -->
                                                    <th style="vertical-align: middle;" class="col-2">Timesheet</th>
                                                </tr>
                                            </thead>
                                            <tbody>
                                                <tr *ngFor="let user of projectCurrentResource; let i =index">
                                                    <td class="d-flex justify-content-between" style="border: none;">
                                                        <i *ngIf="permission.isGranted(WeeklyReport_ReportDetail_CurrentResource_Release)"
                                                            class="fas fa-ellipsis-v ml-1 menu-4-icon"
                                                            [matMenuTriggerFor]="menu4"></i>
                                                        <mat-menu #menu4="matMenu">
                                                            <button [disabled]="projectUserProcess"
                                                                class="mat-menu-item  w-100"
                                                                (click)="releaseUser(user)">
                                                                <i class="fas fa-sign-out-alt mr-1"></i>Release</button>
                                                        </mat-menu>
                                                        <div class="position-relative">
                                                            <app-user-info [isWeeklyReport]="true"
                                                                [isPool]="user.isPool" [workType]="user.workType"
                                                                [userData]="{fullName:user.fullName,branch:user.branch,
                                                                branchColor:user.branchColor,
                                                                branchDisplayName:user.branchDisplayName,
                                                                userType: user.userType, avatarFullPath: user.avatarFullPath,
                                                                position: user.position,
                                                                positionColor: user.positionColor,
                                                                positionName: user.positionName,
                                                                userLevel: user.userLevel}">
                                                            </app-user-info>
                                                        </div>
                                                        <div style="visibility: hidden; position: fixed"
                                                            [style.left]="contextMenuPosition.x"
                                                            [style.top]="contextMenuPosition.y"
                                                            [matMenuTriggerFor]="menu">
                                                        </div>
                                                        <button mat-icon-button [matMenuTriggerFor]="menu"
                                                            style="display: none;">
                                                        </button>
                                                        <mat-menu #menu="matMenu">
                                                            <button
                                                                *ngIf="permission.isGranted(WeeklyReport_ReportDetail_CurrentResource_Release)"
                                                                [disabled]="projectUserProcess"
                                                                class="mat-menu-item  w-100"
                                                                (click)="releaseUser(user)">
                                                                <i class="fas fa-sign-out-alt mr-1"></i>Release</button>
                                                        </mat-menu>
                                                    </td>
                                                    <td class="text-center" style="white-space: break-spaces;">
                                                        <span class="d-flex align-items-center justify-content-between">
                                                            <p PrjResizeContent [collapseLine]="2" style="flex: 1;"
                                                                class="mb-0 p-0  ml-2 max-line-content-2">{{user.note}}
                                                            </p>
                                                            <i style="color: #585858;" class="fas fa-ellipsis-v ml-1"
                                                                [matMenuTriggerFor]="menu3"></i>
                                                            <mat-menu #menu3="matMenu">
                                                                <button class="mat-menu-item  w-100"
                                                                *ngIf="permission.isGranted(WeeklyReport_ReportDetail_CurrentResource_Update_Note)"
                                                                    (click)="editResoureNote(user)">
                                                                    <i class="fas fa-edit mr-2 fa-lg"></i>
                                                                    Edit
                                                                </button>
                                                            </mat-menu>
                                                        </span>
                                                    </td>
                                                    <td class="text-center">
                                                        <div [matTooltip]="user.normalWorkingTime + 'h of project'
                                                + ' / ' + user.normalWorkingTimeAll + 'h all'
                                                + ' / ' + user.normalWorkingTimeStandard + 'h standard'">
                                                            <strong>{{user?.normalWorkingTime}}</strong> /
                                                            <strong
                                                                [ngClass]="(user.normalWorkingTimeAll <= user.normalWorkingTimeStandard)?'':'time-over'">{{user?.normalWorkingTimeAll}}</strong>
                                                            /
                                                            <strong>{{user?.normalWorkingTimeStandard}}</strong>
                                                        </div>
                                                    </td>
                                                    <td class="text-center">
                                                        <div
                                                            [matTooltip]="user.overTimeNoCharge + 'h OT NoCharge' + ' / ' + user.overTime + 'h OT'">
                                                            <strong
                                                                [ngClass]="user.overTimeNoCharge>0?'ot-noCharge': ''">{{user.overTimeNoCharge}}</strong>
                                                            /
                                                            <strong
                                                                [ngClass]="user.overTime>0?'text-danger': ''">{{user.overTime}}</strong>
                                                        </div>
                                                    </td>
                                                    <td style="text-align: -webkit-center;">
                                                        <div style="width: 200px; height: 60px;"
                                                            [id]="'user' + user.userId">
                                                        </div>
                                                    </td>
                                                </tr>
                                            </tbody>
                                        </table>
                                    </div>
                                </div>
                            </mat-expansion-panel>
                        </div>

                        <div class="float-timmer" *ngIf="countdownInterval.value !== null" cdkDrag
                            [class.warning-count-down]="isShowWarning"
                            [class.warning-count-down-time-out]="isShowWarningTimeOut">
                            <div class="count-timer">
                                <span class="action-timmer mr-2" *ngIf="!isShowWarning">
                                    <button (click)="stopTimmer(); $event.stopPropagation()"
                                        *ngIf="!isStopCounting && isStart " class="btn btn-sm mb-2 pr-0">
                                        <i class="fas fa-pause fa-lg"></i>
                                    </button>
                                    <button (click)="startTimmer(); $event.stopPropagation()"
                                        *ngIf="!isStart && !isShowSettingCountDown" class="btn btn-sm mb-2 pr-0">
                                        <i class="fas fa-play fa-lg"></i>
                                    </button>
                                    <button (click)="resumeTimmer(); $event.stopPropagation()"
                                        *ngIf="isStopCounting && !isTimmerCounting && !isRefresh"
                                        class="btn btn-sm mb-2 pr-0">
                                        <i class="fas fa-play fa-lg"></i>
                                    </button>
                                </span>
                                <cd-timer #timmer format="ms" countdown="true" [startTime]="countdownInterval.value"
                                    [autoStart]="false" (onTick)="onTick($event)">
                                    {{ countdownInterval.value * 1000 | date:'mm:ss' }}
                                </cd-timer>
                                <button *ngIf="permission.isGranted(Admin_Configuartions_WeeklyReportTime_Edit)"
                                    class="btn btn-sm  mb-2 pr-0">
                                    <i class="fas fa-clock fa-lg" (click)="openSettingCountDown()"></i>
                                </button>
                                <div class="row" *ngIf="isShowSettingCountDown">
                                    <div class="col-8">
                                        <mat-form-field class="w-100">
                                            <mat-label>
                                                Input time
                                                <span *ngIf="countdownInterval.invalid">{{'(Min 30s)' |
                                                    localize}}</span>
                                            </mat-label>
                                            <input matInput [formControl]="countdownInterval" name="searchPmReportName"
                                                min="30" (keydown)="$event.stopPropagation()" placeholder="(s)">
                                        </mat-form-field>
                                    </div>
                                    <div class="col-4">
                                        <button class="btn btn-sm  mb-2 pr-0">
                                            <i class="fas fa-check fa-lg" (click)="setTimeCountDown()"></i>
                                        </button>
                                        <button class="btn btn-sm  mb-2 pr-0">
                                            <i class="fas fa-times fa-lg" (click)="closeSettingCountDown()"></i>
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="d-flex p-2 align-items-center"
                            style="background: #0d6efd;border-radius: 4px;color: #fff; position: fixed;top: 9%;left: 42%;cursor: all-scroll;"
                            cdkDrag>
                            <i style=" font-size: 24px" (click)="drawer.toggle();drawerLeft=!drawerLeft" class="fas fa-chevron-left"></i>&nbsp;
                            <span style="font-weight: 600;" class="mx-1">
                            </span>&nbsp;
                            <i style=" font-size: 24px;" (click)="drawerRight.toggle()"
                                class="fas fa-chevron-right"></i>
                        </div>
                    </div>
                </div>
            </section>
        </div>
    </div>
</mat-drawer-container>
